# è®©è®¾è®¡æ¨¡å¼é£ä¸€ä¼šå„¿|â‘¤å»ºé€ è€…æ¨¡å¼

## å¼€å¤´æ—¥å¸¸å¹ç‰›

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯é«˜å†·å°±æ˜¯èŒƒå„¿ï¼Œå¥½ä¹…ä¸è§ã€‚æœ€è¿‘æ¯”è¾ƒå¿™ï¼Œæ–‡ç« æ›´æ–°è¾ƒæ…¢ï¼ŒæŠ±æ­‰ã€‚ğŸ˜Šä»Šå¤©æˆ‘ä»¬ç»§ç»­æ¥èŠè®¾è®¡æ¨¡å¼è¿™ä¸ªè¯é¢˜ã€‚å‰é¢å·²ç»è®²è¿‡å‡ ä¸ªæ¨¡å¼ï¼Œå¦‚æœæ²¡æœ‰é˜…è¯»è¿‡çš„æœ‹å‹å¯ä»¥å›é¡¾ä¸€ä¸‹ã€‚

> **å‰æ–‡å›é¡¾**  
> ğŸ‘‰[è®©è®¾è®¡æ¨¡å¼é£ä¸€ä¼šå„¿|â‘ å¼€ç¯‡](è®©è®¾è®¡æ¨¡å¼é£ä¸€ä¼šå„¿|â‘ å¼€ç¯‡.md)  
> ğŸ‘‰[è®©è®¾è®¡æ¨¡å¼é£ä¸€ä¼šå„¿|â‘¡å•ä¾‹æ¨¡å¼](è®©è®¾è®¡æ¨¡å¼é£ä¸€ä¼šå„¿|â‘¡å•ä¾‹æ¨¡å¼.md)   
> ğŸ‘‰[è®©è®¾è®¡æ¨¡å¼é£ä¸€ä¼šå„¿|â‘¢å·¥å‚æ¨¡å¼](è®©è®¾è®¡æ¨¡å¼é£ä¸€ä¼šå„¿|â‘¢å·¥å‚æ¨¡å¼.md)   
> ğŸ‘‰[è®©è®¾è®¡æ¨¡å¼é£ä¸€ä¼šå„¿|â‘£åŸå‹æ¨¡å¼](è®©è®¾è®¡æ¨¡å¼é£ä¸€ä¼šå„¿|â‘£åŸå‹æ¨¡å¼.md)   

é‚£ä¹ˆï¼Œä»Šå¤©æˆ‘ä»¬è¦æ¥èŠçš„æ˜¯**å»ºé€ è€…æ¨¡å¼**ï¼Œè¿™ä¹Ÿæ˜¯GOF23çš„**åˆ›å»ºå‹æ¨¡å¼**ä¸­çš„æœ€åä¸€ä¸ªæ¨¡å¼ã€‚æ—¢ç„¶æ˜¯åˆ›å»ºå‹æ¨¡å¼ï¼Œè‡ªç„¶åˆæ˜¯ä¸€ä¸ªç”¨æ¥åˆ›å»ºå¯¹è±¡çš„æ¨¡å¼ï¼Œè¿™ä»è¿™ä¸ªæ¨¡å¼çš„åå­—ä¸Šä¹Ÿèƒ½çœ‹å‡ºæ¥ã€‚

![dp-4-0](assets/4/dp-4-0.png)

## åœºæ™¯éœ€æ±‚

> å»ºé€ è€…ï¼Œå°±æ˜¯ç”¨æ¥åˆ›å»ºå¯¹è±¡çš„ã€‚è¿™å¬ä¸Šå»å°±æ˜¯ä¸€å¥åºŸè¯......
>

å¯¹è±¡ä¸å°±æ˜¯å»ºé€ å‡ºæ¥çš„å—ï¼Ÿè¿™æ€ä¹ˆè¿˜æˆäº†ä¸€ä¸ªå•ç‹¬çš„æ¨¡å¼äº†ï¼Ÿè€Œä¸”å’Œå‰é¢è¯´çš„é‚£äº›æ¨¡å¼æœ‰å•¥åŒºåˆ«ï¼Ÿ

ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘è¿˜æ˜¯ä¸å¥—ç”¨ä¹¦ä¸Šæˆ–è€…ç½‘ä¸Šçš„ä¸€äº›ç†è®ºï¼Œä½†å°±è‡ªå·±å­¦è¿‡çš„ä¸€äº›ç†è§£ï¼Œç»“åˆç”Ÿæ´»çš„ä¸€äº›åœºæ™¯è·Ÿå¤§å®¶è¯´è¯´ã€‚

ä¸¾ä¸ªç”Ÿæ´»å½“ä¸­ç»„è£…ç”µè„‘çš„ä¾‹å­ï¼Œæ¯”å¦‚ç°åœ¨å°æ˜å»ç”µè„‘åŸç»„è£…ä¸€å°ç”µè„‘ï¼Œä¸€å°å®Œæ•´ç”µè„‘è‚¯å®šä¼šåŒ…å«æ˜¾ç¤ºå™¨ï¼Œé”®ç›˜ï¼Œé¼ æ ‡ç­‰ç­‰ä¸€äº›é…ä»¶ï¼Œè€Œæ¯ä¸ªé…ä»¶çš„é…ç½®å‚æ•°é‚£å°±æˆç™¾ä¸Šåƒäº†ï¼Œè€Œä¸”æ¯ä¸ªç¡¬ä»¶ä¸Šéƒ½ä¼šæœ‰ä¸€äº›ä¸“ä¸šçš„å‚æ•°æˆ‘ä»¬ä¹Ÿçœ‹ä¸æ‡‚ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬éœ€è¦ä¹°çš„åªæ˜¯ä¸€å°ç”µè„‘ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰å–ç”µè„‘çš„äººï¼Œæˆ‘ä»¬éœ€è¦ä¹°ä»€ä¹ˆå“ç‰Œï¼Œä»€ä¹ˆæ¡£æ¬¡ï¼Œä»€ä¹ˆä»·æ ¼çš„ç”µè„‘æˆ–é…ä»¶å³å¯ï¼Œè¿™æ ·ç”µè„‘å•†å®¶å°±ä¼šç»™æˆ‘ä»¬ç»„è£…å¥½ä¸€å°å„æ–¹é¢éƒ½æ¯”è¾ƒåˆé€‚çš„ç”µè„‘ã€‚å°æ˜å¹³æ—¶å°±ç®€å•å†™ä¸ªæ–‡æ¡£çœ‹ä¸ªè§†é¢‘å•¥çš„ï¼Œå¯¹é…ç½®è¦æ±‚ä¸é«˜ï¼Œæ‰€ä»¥åªéœ€è¦å…¥é—¨çº§çš„ç”µè„‘å³å¯ã€‚å¦‚ä¸‹å›¾ï¼š

![dp-4-1](assets/4/dp-4-1.jpg)

ç„¶åå°æ˜ç©äº†å‡ å¹´åä¸Šäº†å¤§å­¦ï¼Œæ— æ„ä¸­æŸ“ä¸Šäº†ç©æ¸¸æˆçš„æ¯›ç—…ï¼Œä¸€å‘ä¸å¯æ”¶æ‹¾ï¼ŒåŸæ¥çš„ç”µè„‘é…ç½®å·²ç»å¡å‡ºç¿”äº†ã€‚äºæ˜¯ï¼Œä»–åˆæƒ³æ¢å°æ¸¸æˆæœ¬ï¼Œå¦‚ä¸‹å›¾ï¼š

![dp-4-2](assets/4/dp-4-2.jpg)

ç„¶åå°æ˜å¤§å­¦æ¯•ä¸šäº†ï¼Œå› ä¸ºå¤§å­¦å¤©å¤©ç©æ¸¸æˆï¼Œæ¯•ä¸šåå®åœ¨æ··ä¸ä¸‹å»äº†ï¼Œå¬è¯´å­¦JavaæŠ€æœ¯å·¥èµ„é«˜ï¼Œè¿˜èƒ½è£…é€¼ï¼Œäºæ˜¯äºŒè¯æ²¡è¯´è½¬è¡Œå­¦Java......ä½†æ˜¯å­¦Javaå†ç”¨åŸæ¥é‚£ä¸ªç ´ç”µè„‘å¯ä¸è¡Œäº†ï¼Œæ€ä¹ˆæ ·ä¹Ÿå¾—ç”¨ä¸ªMacBook Proæ‰é…å¾—ä¸Šç¨‹åºçŒ¿è¿™ä¸ªé«˜å¤§ä¸Šçš„èŒä½å˜›ï¼Œäºæ˜¯......

![dp-4-3](assets/4/dp-4-3.jpg)

ä¸Šé¢è¿™ä¸ªæ˜¯æ—¥å¸¸ç”Ÿæ´»ä¸­éå¸¸å¸¸è§çš„åœºæ™¯ï¼Œé‚£ç”¨ä»£ç å¦‚ä½•å»å®ç°å‘¢ï¼Ÿ

å¦‚æœä½ ä¹‹å‰æ²¡å­¦è¿‡ä»»ä½•è®¾è®¡æ¨¡å¼ï¼Œä½ ä¹Ÿè®¸ä¼šå¦‚ä¸‹è®¾è®¡ï¼ˆä¼ªä»£ç ï¼‰ï¼š

```java
public class Computer {
    å†…å­˜ 
    CPU
    ç¡¬ç›˜
    é¼ æ ‡
		...
}

public class Client{
  void buy(){
    //å…¥é—¨çº§
    Computer comp = new Computer();
    comp.setå†…å­˜("4g");
    comp.setCPU("i3");
    comp.setç¡¬ç›˜("128g");
    comp.seté¼ æ ‡("æ‚ç‰Œ");
    ...
  }
  æŠŠç”µè„‘äº¤ä»˜ç»™å®¢æˆ·...
}
```

è¿™æ ·å†™ç²—çœ‹æ²¡æœ‰ä»€ä¹ˆæ¯›ç—…ï¼Œæˆ‘ä»¬å¹³æ—¶å¤§éƒ¨åˆ†æ—¶å€™å°±æ˜¯è¿™æ ·å†™çš„ã€‚

> é‚£æƒ³æƒ³ï¼Œè¿™æ ·å†™åç»­ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ

ç°åœ¨å°æ˜ç”µè„‘è¦å‡çº§äº†ï¼Œæ¢æˆæ¸¸æˆæœ¬ï¼Œè¿™ä¸ªæ—¶å€™éº»çƒ¦æ¥äº†ï¼Œä»–å¾—å»ä¿®æ”¹ä¸Šé¢`buy()`æ–¹æ³•ä½“å†…çš„ä»£ç äº†ï¼Œå°†åŸæ¥çš„

```java
comp.setå†…å­˜("4g");
comp.setCPU("i3");
comp.setç¡¬ç›˜("128g");
comp.seté¼ æ ‡("æ‚ç‰Œ");
```

ä¿®æ”¹æˆæ–°çš„é…ç½®ï¼š

```java
comp.setå†…å­˜("8g");
comp.setCPU("i5");
comp.setç¡¬ç›˜("256g");
comp.seté¼ æ ‡("ç½—æŠ€ç‰Œ");
```

å†å‡çº§æˆMacBook Proæ—¶ä¹ŸåŒç†ã€‚è€Œä¸”å¦‚æœæˆ‘éœ€è¦å¢åŠ æˆ–è€…å‡å°‘ä¸€äº›é…ç½®ä¹ŸåŒæ ·éœ€è¦å»ä¿®æ”¹åŸæ¥çš„ä»£ç ã€‚

**æ˜¾ç„¶è¿™ä¸ªæ˜¯è¿åâ€œå¼€é—­åŸåˆ™â€äº†ã€‚**

> é‚£é—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ï¼Ÿ

ä¸éš¾çœ‹å‡ºï¼Œ`comp`çš„`setXX()`ç³»åˆ—æ–¹æ³•å’Œ`Client`çš„apiç´§ç´§è€¦åˆäº†ï¼Œè€Œä¸”`Client`éœ€è¦å¯¹è±¡åˆ›å»ºçš„ç»†èŠ‚ä¸€æ¸…äºŒæ¥šï¼Œå¦åˆ™æ²¡æ³•å®Œæˆå¯¹è±¡åˆ›å»ºã€‚

> é‚£æ€ä¹ˆæ ·æ‰èƒ½æŠŠå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹å•ç‹¬ä»å®¢æˆ·ç«¯ä»£ç ä¸­å‰¥ç¦»å‡ºæ¥ï¼Œå®ç°è§£è€¦å‘¢ï¼Ÿ
>

å¦‚æœè¿˜è®°å¾—å‰é¢å­¦è¿‡çš„**å·¥å‚æ¨¡å¼**ï¼Œæœ‰çš„åŒå­¦å¯èƒ½å°±ä¼šæƒ³åˆ°ï¼Œå·¥å‚æ¨¡å¼ä¸å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„å—ï¼ŸæŠŠå¯¹è±¡åˆ›å»ºå’Œå¯¹è±¡çš„ä½¿ç”¨åˆ†ç¦»å®ç°è§£è€¦ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¹¶ä¸éœ€è¦å…³æ³¨å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œéœ€è¦ä¸å¯¹åº”çš„å·¥å‚ç±»æ‰“äº¤é“å³å¯ã€‚å› ä¸ºæˆ‘ä»¬è¿™è¾¹ä¼šæ¶‰åŠåˆ°å¤šä¸ªå¯¹è±¡ï¼Œè€Œä¸”è¿™å¤šä¸ªå¯¹è±¡ä¹‹é—´ä¹Ÿå­˜åœ¨ä¸€äº›å…³è”ï¼Œæ‰€ä»¥æ­¤å¤„å¯ä»¥é‡‡ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼å®ç°ã€‚æ‰€ä»¥ç»è¿‡ä¼˜åŒ–ï¼Œä½ å¯èƒ½ä¼šå¦‚ä¸‹å®ç°ï¼š

```java
interface ComputerFactory{
  å†…å­˜ createå†…å­˜();
  CPU createCPU();
  ...
}
```

ç„¶åé’ˆå¯¹ä¸åŒå®šä½çš„ç”µè„‘ï¼Œåˆ›å»ºå…¶ä¸åŒçš„`Factory`å®ç°ç±»å³å¯ã€‚

```java
class å…¥é—¨çº§ implements ComputerFactory{
	å†…å­˜ createå†…å­˜(){
    ç”Ÿäº§4Gå†…å­˜
  }
  CPU createCPU(){
    ç”Ÿäº§i3å†…å­˜
  }
  ...
}
```

ç„¶å`Client`çš„ä»£ç ä¼šä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š

```java
//å…¥é—¨çº§
public class Client{
  ComputerFactory factory;
  void buy(){    
    Computer comp = new Computer();
    comp.setå†…å­˜(factory.createå†…å­˜());
    comp.setCPU(factory.createCPU());
    ...
  }
  æŠŠç”µè„‘äº¤ä»˜ç»™å®¢æˆ·...
}
```

è¿™æ ·çš„è¯ï¼Œå¦‚æœæˆ‘éœ€è¦å‡çº§é…ç½®ï¼Œåªéœ€è¦ä¼ å…¥ä¸åŒçš„`ComputerFactory`å°±å¯ä»¥äº†ï¼Œä¸šåŠ¡é€»è¾‘çš„ä»£ç æ˜¯ä¸éœ€è¦å†åŠ¨äº†ã€‚ä½†æ˜¯å¯¹äºè¿™ä¸ªéœ€æ±‚ï¼Œè¿™æ ·çš„è§£å†³æ–¹æ³•æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜çš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

ä¹‹å‰åœ¨è®²å·¥å‚æ¨¡å¼çš„æ—¶å€™è¯´è¿‡ï¼Œå·¥å‚æ¨¡å¼ä¸»è¦æ˜¯ç”¨æ¥ç”Ÿäº§**ä¸€ä¸ªå®Œæ•´çš„äº§å“**çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨å·¥å‚æ¨¡å¼åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ï¼Œå°±æ˜¯**ä¸€ä¸ªæœ€ç»ˆçš„äº§å“**äº†ã€‚è™½ç„¶æŠ½è±¡å·¥å‚æ¨¡å¼å¯ä»¥ä¸€ä¸‹å­åˆ›å»ºå¤šä¸ªäº§å“ï¼Œä½†æ˜¯è¿™å¤šä¸ªäº§å“å…¶æœ¬èº«å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æœ€ç»ˆçš„äº§å“ï¼Œç›´æ¥å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œæ— éæ˜¯æŠ½è±¡å·¥å‚æ¨¡å¼åˆ›å»ºçš„è¿™äº›ä¸ªäº§å“ä¹‹ç±»æœ‰ä¸€äº›å…³è”ï¼Œå±äºåŒä¸€ä¸ªç±»å‹çš„ä¸œè¥¿ã€‚

ä½†æ˜¯æˆ‘ä»¬çš„è¿™ä¸ªéœ€æ±‚ä¸­ï¼Œåƒå†…å­˜ã€CPUã€é¼ æ ‡ç­‰è¿™äº›ï¼Œ**å¯¹äºç”µè„‘è€Œè¨€**ï¼Œéƒ½åªæ˜¯æ•´å°ç”µè„‘çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†è€Œå·²ï¼Œä»–ä»¬å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„äº§å“ï¼Œéœ€è¦å°†ä»–ä»¬ç»„åˆè£…é…èµ·æ¥æ‰èƒ½æ„æˆä¸€ä¸ªå®Œæ•´çš„ç”µè„‘å¯¹è±¡ã€‚å› ä¸ºè¿™ä¸ªéœ€æ±‚ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¾—åˆ°çš„æ˜¯ä¸€ä¸ªç”µè„‘å¯¹è±¡ï¼Œè€Œå¹¶ä¸æ˜¯å†…å­˜ã€CPUã€é¼ æ ‡ç­‰è¿™äº›ä¸ªé›¶ä»¶ã€‚

å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å·¥å‚æ¨¡å¼æ¥åˆ›å»ºè¿™äº›ä¸ªé›¶ä»¶ï¼Œä½†æ˜¯ï¼Œä¹‹åä½ ä¹Ÿè¿˜éœ€è¦è‡ªå·±å»å¯¹è¿™äº›é›¶éƒ¨ä»¶è¿›è¡Œç»„è£…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ è¿˜æ˜¯éœ€è¦å¯¹è¿™ä¸ªå¯¹è±¡çš„ç»„æˆç»†èŠ‚äº†è§£æ¸…æ¥šï¼Œå¦åˆ™ï¼Œä½ è¿˜æ˜¯æ— æ³•åˆ›å»ºå‡ºä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ã€‚å¦å¤–ï¼Œè¿˜ä¼šå‡ºç°å¤šä¸€ä¸ªé›¶ä»¶ï¼Œå°‘ä¸€ä¸ªé›¶ä»¶çš„é—®é¢˜ï¼Œä¼šå¢åŠ å®¢æˆ·ç«¯çš„å¤æ‚åº¦ã€‚

äºæ˜¯ï¼Œæˆ‘ä»¬ä»Šå¤©è¦è®²çš„ä¸»è§’â€”â€”**å»ºé€ è€…æ¨¡å¼**å°±é—ªäº®ç™»åœºäº†ã€‚

## è§£å†³éœ€æ±‚

å»ºé€ è€…æ¨¡å¼è¦è§£å†³çš„åœºæ™¯å°±æ˜¯è¿™ä¸ªéœ€æ±‚ï¼Œè‡´åŠ›äºå°†ä¸€ç³»åˆ—çç¢çš„é›¶éƒ¨ä»¶ç»„è£…æˆä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ï¼Œè€Œè¿™å…¶ä¸­å…·ä½“çš„ç»„è£…ç»†èŠ‚å®¢æˆ·ç«¯æ˜¯ä¸éœ€è¦çŸ¥é“çš„ã€‚

åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œæœ‰ä¸€ä¸ªæŠ½è±¡æ¥å£ï¼Œé‡Œé¢ä¼šå®šä¹‰ä¸€ç³»åˆ—å¯¹è±¡é›¶éƒ¨ä»¶çš„è£…é…çš„æ–¹æ³•ï¼ˆç»„è£…å†…å­˜ã€CPUã€é¼ æ ‡ç­‰è¿™äº›ä¸ªé›¶ä»¶ï¼‰ã€‚ç„¶åä¼šæœ‰ä¸€ä¸ªç»„è£…çš„äººï¼ˆæ¯”å¦‚ç”µè„‘å–å®¶ï¼‰ï¼Œå¯¹è¿™äº›ä¸ªé›¶éƒ¨ä»¶è¿›è¡Œç»„è£…ï¼Œæœ€åç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ã€‚å°±æ¯”å¦‚ä¸Šé¢ç»„è£…ç”µè„‘çš„ä¾‹å­ã€‚

![dp-4-4](assets/4/dp-4-4.jpg)

å®ç°ä»£ç å¦‚ä¸‹ï¼š

```java
//æŠ½è±¡æ¥å£å®šä¹‰å®Œæ•´å¯¹è±¡çš„é›¶éƒ¨ä»¶è£…é…æ–¹æ³•
abstract class ComputerBuilder{
    protected Computer comp = new Computer(); 
    abstract void buildå†…å­˜();
    abstract void buildCPU();
    abstract void buildç¡¬ç›˜();
  	protected Computer getComputer(){
        return comp;
    }
}
```

ç„¶åé’ˆå¯¹äºä¸åŒçº§åˆ«çš„ç”µè„‘ï¼Œå¯ä»¥åˆ›å»ºå…¶å¯¹åº”çš„æŠ½è±¡æ¥å£çš„å®ç°ç±»ï¼Œä»¥å®Œæˆå¯¹ç”µè„‘çš„è£…é…ï¼Œæ¯”å¦‚ç°åœ¨éœ€è¦è£…é…ä¸€å°MacBook Proï¼Œåˆ™å®ç°å¦‚ä¸‹ï¼š

```java
class MacBookProBuilder extends ComputerBuilder{
    void buildå†…å­˜() {
        comp.setå†…å­˜("16g");
    }
    void buildCPU() {
        comp.setCPU("i7");
    }
    void buildç¡¬ç›˜() {
        comp.setç¡¬ç›˜("1T");
    }
}
```

è¿˜è¦éœ€è¦ä¸€ä¸ªä¸“é—¨è´Ÿè´£è£…é…çš„å¯¹è±¡ï¼Œæ¯”å¦‚ç”µè„‘å–å®¶ï¼Œ

```java
class Seller{
  ComputerBuilder builder;
  Computer sell(){
    builder.buildå†…å­˜();
    builder.buildCPU();
    builder.buildç¡¬ç›˜();
    return builder.getComputer();
  }
}
```

è¿™ä¸ªæ—¶å€™åœ¨Clientä¸­çš„ä»£ç å˜æˆäº†å¦‚ä¸‹ï¼š

```java
//MacBook Pro
public class Client{
  Seller seller;
  void buy(){    
    Computer comp = seller.sell();
  }
  æŠŠç”µè„‘äº¤ä»˜ç»™å®¢æˆ·...
}
```

æˆ‘ä»¬ä¼šå‘ç°ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å·²ç»å®Œæˆè§£è€¦ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰ç”µè„‘å–å®¶æˆ‘ä»¬éœ€è¦ä»€ä¹ˆçº§åˆ«çš„ç”µè„‘ï¼Œä»–å°±ä¼šç»™æˆ‘ä»¬è¿”å›ä¸€å°è£…é…å¥½çš„å®Œæ•´çš„å¯¹è±¡ï¼Œå†ä¹Ÿä¸éœ€è¦å»äº†è§£å„ä¸ªé›¶ä»¶æ˜¯æ€ä¹ˆç”Ÿäº§çš„ï¼ˆæ˜¯é€šè¿‡å•ä¾‹æ¨¡å¼åˆ›å»ºçš„ï¼Ÿè¿˜æ˜¯åŸå‹æ¨¡å¼ï¼Ÿè¿˜æ˜¯å·¥å‚æ¨¡å¼ï¼Ÿï¼‰ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“è¿™äº›é›¶éƒ¨ä»¶æ˜¯æ€ä¹ˆæ‹¼è£…èµ·æ¥çš„ï¼ˆæ˜¯å…ˆè£…é…CPUï¼Œè¿˜æ˜¯å…ˆè£…é…ç¡¬ç›˜ï¼Ÿï¼‰ã€‚è¿™æ ·å°±å®Œç¾çš„è§£å†³äº†è§£è€¦çš„é—®é¢˜ã€‚

ç°åœ¨å‡è®¾å°æ˜æƒ³å†æ¢ä¸€ä¸ªé…ç½®çš„ç”µè„‘ï¼Œåªéœ€è¦å†æä¾›ä¸€ä¸ªå¯¹åº”çš„`Buidler`å­ç±»ï¼Œå®Œæˆå¯¹åº”é›¶ä»¶çš„åˆ›å»ºï¼Œç„¶åå°†`Builder`äº¤ç»™è´Ÿè´£è£…é…çš„äººï¼ˆæœ¯è¯­å«`Director`ï¼‰ï¼Œå¦‚å–å®¶ï¼Œå°±å¯ä»¥äº†ï¼Œ`Client`å†ä¹Ÿä¸éœ€è¦æœ‰ä»»ä½•çš„æ”¹åŠ¨ï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚

åœ¨å¯¹è±¡æ²¡æœ‰é‚£ä¹ˆå¤æ‚çš„æƒ…å†µä¸‹ï¼Œ`Director`ä¹Ÿæ˜¯å¯ä»¥çœç•¥çš„ï¼Œç›´æ¥å°†è£…é…è¿‡ç¨‹åœ¨`Client`ç«¯å®ç°å³å¯ã€‚å½“ç„¶åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`Client`æ˜¯éœ€è¦å¯¹è¯¥å¯¹è±¡çš„ç»„æˆç»“æ„æœ‰æ‰€äº†è§£çš„ï¼Œä¹Ÿå®¹æ˜“å¯¼è‡´ç¼ºèƒ³è†Šå°‘è…¿çš„æƒ…å†µã€‚

å¦å¤–ï¼Œä¸Šé¢çš„ä»£ç å…¶å®å¯ä»¥ä¿®æ”¹ä¸ºæ›´ä¸ºä¼˜é›…çš„å†™æ³•ã€‚

```java
class MacBookProBuilder extends ComputerBuilder{
    void buildå†…å­˜() {
        comp.setå†…å­˜("16g");
      	return this;
    }
    void buildCPU() {
        comp.setCPU("i7");
      	return this;
    }
    void buildç¡¬ç›˜() {
        comp.setç¡¬ç›˜("1T");
      	return this;
    }
}
```

åœ¨æ¯ä¸€ä¸ªè£…é…çš„æ–¹æ³•ä¸­éƒ½è¿”å›å½“å‰`Builder`å¯¹è±¡ï¼Œè¿™æ ·`Director`ä¸­è£…é…é€»è¾‘å¯ä»¥ç›´æ¥ä»¥æ¸…çˆ½ç®€æ´çš„é“¾å¼é£æ ¼ä¹¦å†™ã€‚

```java
class Seller{
  ComputerBuilder builder;
  Computer sell(){
    return builder.buildå†…å­˜().buildCPU().buildç¡¬ç›˜().getComputer();
  }
}
```

è¿™ç§é“¾å¼é£æ ¼å¯ä»¥å¾ˆå¥½çš„ç”¨æ¥è§£å†³**ä¼¸ç¼©æ„é€ å™¨åæ¨¡å¼**çš„é—®é¢˜ã€‚ä»€ä¹ˆæ„æ€ï¼Ÿ

æ¯”å¦‚ç°åœ¨æŸä¸€ä¸ªç±»ï¼Œå±æ€§æå¤šï¼Œæœ‰ä¸Šç™¾ä¸ªå§......

```java
class A{
  å±æ€§1;
  å±æ€§2;
  å±æ€§3;
  å±æ€§4;
  ...çœç•¥100ä¸ªå±æ€§
}
```

ç°åœ¨æˆ‘éœ€è¦åœ¨æŸå¤„åˆ›å»ºè¯¥ç±»å¯¹è±¡ï¼Œå¹¶ä¸”è¿˜éœ€è¦å¯¹å…¶ä¸­æŸä¸€äº›å±æ€§è¿›è¡Œèµ‹å€¼ã€‚å¦‚æœè¿™ä¸ªæ—¶å€™æˆ‘ä»¬é‡‡ç”¨æ„é€ å™¨æ¥åˆ›å»ºå°±ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å› ä¸ºæˆ‘å¯èƒ½æ¯ä¸€æ¬¡åˆ›å»ºæ‰€éœ€è¦çš„å±æ€§å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯”å¦‚åœ¨åº”ç”¨æŸå¤„éœ€è¦åˆ›å»ºä¸€ä¸ªAå¯¹è±¡ï¼Œéœ€è¦ä½¿ç”¨å±æ€§1ã€å±æ€§2ã€å±æ€§3ï¼Œäºæ˜¯æˆ‘ä¼šåœ¨Aç±»ä¸­åŠ å…¥ä¸€ä¸ªæ„é€ å™¨ï¼Œ

```java
class A {
  //çœç•¥å±æ€§
  public A(å±æ€§1,å±æ€§2,å±æ€§3){}
}
```

åœ¨åº”ç”¨å¦å¤–ä¸€å¤„åˆéœ€è¦åˆ›å»ºä¸€ä¸ªAå¯¹è±¡ï¼Œéœ€è¦ä½¿ç”¨å±æ€§1ã€å±æ€§2ã€å±æ€§3ã€å±æ€§4ï¼Œäºæ˜¯ä½ åˆéœ€è¦æ·»åŠ ä¸€ä¸ªæ„é€ å™¨ï¼Œ

```java
class A {
  //çœç•¥å±æ€§
  public A(å±æ€§1,å±æ€§2,å±æ€§3,å±æ€§4){}
}
```

å¯ä»¥æƒ³è±¡ï¼Œè¦æ˜¯å„å¤„å¼•ç”¨æ„é€ å™¨ç‰¹åˆ«å¤šï¼Œå¹¶ä¸”å‚æ•°è¿˜éƒ½ä¸ä¸€æ ·ï¼Œé‚£ç”»é¢å¤ªç¾ä¸æ•¢æƒ³è±¡ã€‚è¿˜æœ‰ï¼Œå½“æ„é€ å™¨é‡è½½å¤ªå¤šï¼Œåˆ›å»ºå¯¹è±¡æ—¶é€‰æ‹©åˆé€‚æ„é€ å™¨éƒ½æ˜¯ä¸€ä»¶å¾ˆè´¹ç¥çš„äº‹æƒ…ã€‚è¿™ä¸ªæ—¶å€™ä½¿ç”¨å»ºé€ è€…æ¨¡å¼çš„é“¾å¼é£æ ¼å°±å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚

```java
class ABuilder{
  A a = new A();
  A setå±æ€§1(xxx){... return this;}
  A setå±æ€§2(xxx){... return this;}
  A setå±æ€§3(xxx){... return this;}
  A setå±æ€§4(xxx){... return this;}
  A build(){return a;}
 ...
}
```

è¿™ä¸ªæ—¶å€™æˆ‘å†åˆ›å»ºä¸€ä¸ªAå¯¹è±¡ï¼Œå¦‚ä¸‹ï¼Œå¦‚æœæˆ‘éœ€è¦ä¿®æ”¹å±æ€§è®¾ç½®çš„ä¸ªæ•°ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œè°ƒæ•´ï¼Œå¾ˆå¥½çš„è§£å†³äº†é‡è½½æ„é€ å™¨çš„é—®é¢˜ã€‚

```java
A a = new ABuilder().setå±æ€§1(xxx),setå±æ€§2(xxx).setå±æ€§3(xxx).setå±æ€§4(xxx).build();
```

## æ€»ç»“

å…³äºå»ºé€ è€…æ¨¡å¼çš„æ ¸å¿ƒå†…å®¹å°±è¿™äº›ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€ä¸‹æ€»ç»“ã€‚

- ä½œä¸ºåˆ›å»ºå‹æ¨¡å¼ï¼Œå»ºé€ è€…æ¨¡å¼ä¹Ÿæ˜¯ç”¨æ¥åˆ›å»ºå¯¹è±¡çš„ï¼Œè€Œä¸”ä»–å’Œå·¥å‚æ¨¡å¼çœ‹ä¸Šå»ä¼šæ¯”è¾ƒç›¸ä¼¼ï¼Œç”šè‡³éš¾ä»¥åŒºåˆ†ã€‚

  - ä¸è¿‡å»ºé€ è€…æ¨¡å¼å…³é”®ç‚¹åœ¨äºå»ºé€ å’Œè£…é…åˆ†ç¦»ã€‚å»ºé€ è€…æœ€ç»ˆåªä¼šç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªå¯¹è±¡ä¸€èˆ¬æ¥è¯´æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œé‡Œé¢ä¼šåˆ†æˆå¥½å‡ ä¸ªæ¨¡å—ï¼Œå»ºé€ è€…æ¨¡å¼å¼ºè°ƒçš„æ˜¯è¿™ä¸ªè£…é…çš„è¿‡ç¨‹ã€‚

  - è€Œå·¥å‚æ¨¡å¼ï¼Œä¸»è¦å¼ºè°ƒçš„æ˜¯åˆ›å»ºï¼Œå½“ç„¶è¿™ä¸ªåˆ›å»ºæœ‰å¯èƒ½æ˜¯ä¼šåŒæ—¶åˆ›å»ºä¸€ä¸ªï¼ˆç®€å•å·¥å‚æˆ–è€…å·¥å‚æ–¹æ³•æ¨¡å¼ï¼‰æˆ–è€…å¤šä¸ªå¯¹è±¡ï¼ˆæŠ½è±¡å·¥å‚æ¨¡å¼ï¼‰ã€‚è™½ç„¶å·¥å‚æ¨¡å¼åˆ›å»ºçš„ä¹Ÿæœ‰å¯èƒ½å¾ˆå¤æ‚ï¼Œä½†æ˜¯ä»–ä¸å…³å¿ƒå¯¹è±¡ä¼šä¸ä¼šæœ‰è£…é…çš„è¿‡ç¨‹ï¼Œåªè¦åˆ›å»ºå‡ºæ¥å³å¯ã€‚

    å¦‚ä¸‹å›¾ï¼š

    ![dp-4-5](assets/4/dp-4-5.jpg)

    > **ä¸€è¨€ä»¥è”½ä¹‹ï¼Œå·¥å‚æ¨¡å¼å¼ºè°ƒåˆ›å»ºï¼Œå»ºé€ è€…æ¨¡å¼å¼ºè°ƒç»„è£…ã€‚**
    
    å…¶å®è®¾è®¡æ¨¡å¼è¿™ä¸œè¥¿å¹¶ä¸æ˜¯å¾ˆç»å¯¹å¾ˆå­¤ç«‹çš„å»çœ‹å¾…ï¼Œå› æ­¤æˆ‘ä»¬æ²¡æœ‰å¿…è¦å°†æ¯ä¸€ä¸ªæ¨¡å¼çš„åŒºåˆ«éƒ½åˆ†å¾—ç‰¹åˆ«æ˜ç¡®ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè®¾è®¡æ¨¡å¼ä¹Ÿä¸æ˜¯ç‹¬ç«‹ä½¿ç”¨çš„ï¼Œä¼šç›¸äº’æ­é…ã€‚å°±æ¯”å¦‚è¿™è¾¹å¾—å·¥å‚æ¨¡å¼å’Œå»ºé€ è€…æ¨¡å¼ï¼Œä¸¤è€…ä¾§é‡ç‚¹ä¸åŒï¼Œä½†æ˜¯å®Œå…¨å¯ä»¥ç»“åˆä½¿ç”¨ã€‚æ¯”å¦‚åœ¨ä½¿ç”¨å·¥å‚æ¨¡å¼åˆ›å»ºå¯¹è±¡æ—¶ï¼Œæœ‰å¯èƒ½æ¯ä¸ªå¯¹è±¡éƒ½ä¼šæœ‰æ¯”è¾ƒæ˜ç¡®çš„è£…é…è¿‡ç¨‹ï¼Œå°±å¯ä»¥ç»“åˆä½¿ç”¨ã€‚åè¿‡æ¥å—ï¼Œåœ¨ä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ—¶ï¼Œæ¯ä¸€æ­¥çš„è£…é…æ‰€éœ€è¦çš„é›¶ä»¶ï¼Œåˆæœ‰å¯èƒ½æ˜¯é€šè¿‡å·¥å‚æ¨¡å¼ï¼ˆå½“ç„¶ä¹Ÿæœ‰å¯èƒ½æ˜¯é€šè¿‡åŸå‹æ¨¡å¼ï¼Œå•ä¾‹æ¨¡å¼ï¼‰åˆ›å»ºæ‰€å¾—ã€‚

- åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯åªéœ€è¦ä¸`Director`äº¤äº’ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“å†…éƒ¨çš„å¯¹è±¡æ„å»ºå’Œè£…é…çš„ç»†èŠ‚ï¼Œå±è”½äº†ç³»ç»Ÿå¤æ‚åº¦ã€‚

- å¯ä»¥ä¸ºç³»ç»Ÿä¸­æ·»åŠ å¤šä¸ª`Builder`ï¼Œæ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­ä¸ºä¸åŒå“ç‰Œçš„ç”µè„‘åˆ†åˆ«åˆ›å»ºä¸€ä¸ª`Builder`å¯¹è±¡ï¼Œæ¥è¾¾åˆ°æ‰©å±•ç³»ç»ŸåŠŸèƒ½çš„ç›®çš„ã€‚åŒæ—¶ï¼Œé€šè¿‡è°ƒæ•´æ¯ä¸€ä¸ª`Builder`å†…éƒ¨è£…é…çš„è¿‡ç¨‹ï¼Œæœ‰å¯èƒ½è½»æ¾å¯¹è£…é…è¿‡ç¨‹ä¸­çš„æ¯ä¸€æ­¥è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶å’Œå®šåˆ¶ã€‚

## å­˜åœ¨çš„é—®é¢˜  

æ²¡æœ‰ä¸€ä¸ªè®¾è®¡æ¨¡å¼æ˜¯å®Œç¾çš„ï¼Œæ¯ä¸€ä¸ªè®¾è®¡æ¨¡å¼éƒ½æœ‰å…¶ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ã€‚é€šè¿‡ä¸Šé¢åˆ†æï¼Œä¸éš¾å‘ç°ï¼Œ

- å»ºé€ è€…æ¨¡å¼ä¸»è¦ç”¨äºåˆ›å»ºé‚£äº›**å…·æœ‰æ˜æ˜¾ç»„è£…è¿‡ç¨‹**çš„ä¸€ç±»å¤æ‚å¯¹è±¡ï¼Œå¹¶ä¸”è¿™ç±»å¯¹è±¡ä¸­**å†…éƒ¨ç»“æ„å·®å¼‚æ€§éƒ½ä¸å¤§**ï¼ŒåŸºæœ¬ç»“æ„éƒ½ç›¸åŒï¼Œå¹¶ä¸”æ¯”è¾ƒç¨³å®šã€‚æ¯”å¦‚ä¸Šé¢çš„ç”µè„‘çš„ä¾‹å­ï¼Œä¸ç®¡å•¥ç‰Œå­çš„ç”µè„‘ï¼Œå•¥çº§åˆ«çš„ç”µè„‘ï¼Œé…ä»¶éƒ½æ˜¯é‚£äº›ï¼ŒCPUï¼Œå†…å­˜ï¼Œç¡¬ç›˜ç­‰ï¼Œå˜ä¸å‡ºèŠ±æ¥äº†ï¼Œæ— éå°±æ˜¯æ¯ç§é…ä»¶çš„å…·ä½“å‚æ•°ä¸åŒã€‚å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœæ˜¯ä¸¤ç±»å·®å¼‚æ€§å¾ˆå¤§çš„å¯¹è±¡ï¼Œä¸€ç±»æ˜¯ç”µè„‘ï¼Œä¸€ç±»æ˜¯æ±½è½¦ï¼Œå®Œå…¨æ˜¯å…«ç«¿å­æ‰“ä¸ç€çš„ä¸¤ç±»äº§å“ï¼Œè£…é…è¿‡ç¨‹æ›´æ˜¯å¤©å·®åœ°åˆ«ï¼Œè‡ªç„¶æ˜¯æ²¡æ³•ä½¿ç”¨å»ºé€ è€…æ¨¡å¼çš„ã€‚

  > ä¸€ä¸ªç±»çš„å„ä¸ªç»„æˆéƒ¨åˆ†çš„å…·ä½“å®ç°ç±»æˆ–è€…ç®—æ³•ç»å¸¸é¢ä¸´ç€å˜åŒ–ï¼Œä½†æ˜¯å°†ä»–ä»¬ç»„åˆåœ¨ä¸€èµ·çš„ç®—æ³•å´ç›¸å¯¹ç¨³å®šã€‚å»ºé€ è€…æ¨¡å¼æä¾›ä¸€ç§å°è£…æœºåˆ¶ï¼Œå°†**ç¨³å®šçš„ç»„åˆç®—æ³•**äºæ˜“å˜çš„å„ä¸ªç»„æˆéƒ¨åˆ†éš”ç¦»å¼€æ¥ã€‚

- å»ºé€ è€…æ¨¡å¼åˆ›å»ºçš„å¯¹è±¡ä¸€èˆ¬**å†…éƒ¨å˜åŒ–æ˜¯ä¸å¤§ï¼Œä¸é¢‘ç¹çš„**ã€‚å¯¹äºå˜åŠ¨å¾ˆé¢‘ç¹çš„ä¹Ÿæ˜¯ä¸é€‚åˆç”¨å»ºé€ è€…æ¨¡å¼çš„ã€‚å°±åƒä¹°ç”µè„‘ï¼Œä½ ä¸‰å¤©ä¸¤å¤´æ¢ç”µè„‘ï¼Œå‡çº§é…ç½®ï¼Œè€Œæ¯å‡çº§ä¸€å¥—é…ç½®ï¼Œå°±éœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„`Builder`ç±»ï¼Œå¦‚æœå˜åŠ¨å¤ªå¤šï¼Œç³»ç»Ÿä¸­å°±éœ€è¦ç»´æŠ¤å¤§é‡çš„`Builder`ç±»ï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚åº¦å’Œç»´æŠ¤éš¾åº¦ã€‚

## æŠ›ç –å¼•ç‰

æœ€åæˆ‘ä¸¾ä¸¤ä¸ªæˆ‘çŸ¥é“çš„åœ¨å®é™…æ¡†æ¶æˆ–è€…`JDK`æºç ä¸­ä½¿ç”¨å»ºé€ è€…æ¨¡å¼çš„ä¾‹å­ã€‚å…¶å®å»ºé€ è€…æ¨¡å¼åœ¨å®é™…å¼€å‘ä¸­åº”ç”¨ä¹Ÿæ˜¯éå¸¸å¹¿æ³›çš„ï¼Œè€Œä¸”ä¹Ÿæ¯”è¾ƒå¥½è¯†åˆ«ï¼ŒåŸºæœ¬ä»¥`xxxBuilder`å‘½åçš„éƒ½æ˜¯ä½¿ç”¨äº†å»ºé€ è€…æ¨¡å¼ã€‚

æ¯”å¦‚`JDK`ä¸­ï¼Œ`StringBuilder`ç±»æ˜¯ä¸€ä¸ªç»å…¸çš„å»ºé€ è€…æ¨¡å¼å®ç°ï¼Œ

```java
//ç»å…¸ç”¨æ³•
String s = new StringBuilder("a").append("b").append("c").toString();
```

`StringBuilder`ç»§æ‰¿è‡ª`AbstractStringBuilder`ï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œåœ¨å®ƒé‡Œé¢å®šä¹‰äº†ä¸€ä¸ªå±æ€§`value`æ•°ç»„ã€‚

```java
abstract class AbstractStringBuilder implements Appendable, CharSequence {
	//çœç•¥æ— å…³ä»£ç 
    char[] value;
  //çœç•¥æ— å…³ä»£ç 
}
```

å½“æˆ‘ä»¬è°ƒç”¨`StringBuilder`çš„æ„é€ å™¨æˆ–è€…æ˜¯`append()`æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯å¯¹è¯¥`value`æ•°ç»„æ“ä½œã€‚æ¯”å¦‚`append()`ä¸ºä¾‹ï¼Œ

```java
 public StringBuilder append(CharSequence s) {
   super.append(s);
   return this;
}
```

ä»–ä¼šå»è°ƒç”¨çˆ¶ç±»çš„`append()`æ–¹æ³•ï¼ŒåŒæ—¶ä¼š`return this`ï¼Œå®ç°é“¾å¼é£æ ¼çš„ç¼–ç¨‹ã€‚åœ¨çˆ¶ç±»`append()`æ–¹æ³•ä¸­ï¼Œæœ€ç»ˆä¼šè°ƒç”¨å¦‚ä¸‹ï¼š

```java
public AbstractStringBuilder append(CharSequence s, int start, int end) {   
  //çœç•¥ä¸€äº›æ ¡éªŒæ‰©å®¹æ“ä½œ
  for (int i = start, j = count; i < end; i++, j++)
    value[j] = s.charAt(i);
  count += len;
  return this;
}
```

å…¶å®å°±æ˜¯å¾€`value`æ•°ç»„ä¸­è®¾ç½®ä¼ å…¥çš„å­—ç¬¦ä¸²å€¼ã€‚æœ‰ç‚¹åƒ`ArrayList`çš„æ„Ÿè§‰ã€‚

å½“è°ƒç”¨`toString()`æ–¹æ³•æ—¶ï¼Œå…¶å®å°±æ˜¯æŠŠ`value`æ•°ç»„çš„å†…å®¹è½¬æˆ`String`è¿”å›ç½¢äº†ã€‚

```java
public String toString() {
  return new String(value, 0, count);
}
```

å¦å¤–ï¼Œåœ¨`Mybatis`ä¸­ä¹Ÿæ˜¯å¤§é‡ä½¿ç”¨äº†å»ºé€ è€…æ¨¡å¼ã€‚åœ¨`Mybatis`å¯åŠ¨æ—¶ï¼Œä¼šåšä¸€ç³»åˆ—çš„è§£æå·¥ä½œï¼Œæ¯”å¦‚`mybatis-config.xml`æ–‡ä»¶è§£æï¼Œå„`Mapper.xml`ï¼Œè¿˜æœ‰`Mapper`æ¥å£ä¸Šçš„æ³¨è§£ç­‰ï¼Œè¿™ä¸€ç³»åˆ—çš„è§£æå·¥ä½œéƒ½æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„`Builder`å®Œæˆçš„ã€‚é¡¶å±‚æ˜¯`BaseBuilder`ç±»ã€‚è¿™äº›`Builder`çš„å±‚æ¬¡ç»“æ„å¦‚ä¸‹å›¾ï¼Œæ¯”å¦‚ï¼Œ`XMLConfigBuilder`å°±æ˜¯ç”¨æ¥è§£æ`mybatis-config.xml`æ–‡ä»¶ï¼Œ`XMLMapperBuilder`ç”¨æ¥è§£æå„`Mapper.xml`ç­‰ã€‚

![dp-4-6](assets/4/dp-4-6.jpg)

åœ¨è¿™é‡Œï¼Œ`BaseBuilder`ä½œä¸ºä¸€ä¸ªé¡¶å±‚æŠ½è±¡æ¥å£ï¼Œé‡Œé¢åªå®šä¹‰äº†ä¸€äº›æ‰€æœ‰å…·ä½“`Builder`çš„å±æ€§å’Œæ–¹æ³•ï¼Œæ¯”å¦‚å…¨å±€é…ç½®`Configuration`å¯¹è±¡ã€‚è€Œå…¶ä½™`Builder`å­ç±»ä½œä¸ºå…·ä½“å»ºé€ è€…å®Œæˆå„è‡ªçš„è§£æå·¥ä½œã€‚æˆ‘ä»¬è¿™è¾¹ä»¥`XMLConfigBuilder`ä¸ºä¾‹ï¼Œ`XMLConfigBuilder.parse()`æ–¹æ³•æ˜¯è§£æçš„æ ¸å¿ƒæ–¹æ³•ã€‚é‡Œé¢ä¼šè°ƒç”¨`BseBuilder`ä¸­çš„`parseConfiguration()`æ–¹æ³•ã€‚`parseConfiguration()`æ–¹æ³•å°±æ˜¯æ•´ä¸ªè£…é…æµç¨‹ï¼Œ

```java
private void parseConfiguration(XNode root) {
      propertiesElement(root.evalNode("properties"));
      Properties settings = settingsAsProperties(root.evalNode("settings"));
      loadCustomVfs(settings);
      loadCustomLogImpl(settings);
      typeAliasesElement(root.evalNode("typeAliases"));
      pluginElement(root.evalNode("plugins"));
      objectFactoryElement(root.evalNode("objectFactory"));
      objectWrapperFactoryElement(root.evalNode("objectWrapperFactory"));
      reflectorFactoryElement(root.evalNode("reflectorFactory"));
      settingsElement(settings);
      environmentsElement(root.evalNode("environments"));
      databaseIdProviderElement(root.evalNode("databaseIdProvider"));
      typeHandlerElement(root.evalNode("typeHandlers"));
      mapperElement(root.evalNode("mappers"));
}
```

æˆ‘ä»¬ä»¥`propertiesElement`ä¸ºä¾‹ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šä½¿ç”¨`XPATH`è§£æ`properties`å­—æ®µä¸­çš„`resource`ï¼Œ`url`å±æ€§ï¼Œå¹¶ä¸”ä¼šå°†å…¶è®¾ç½®åˆ°å®šä¹‰åœ¨`BaseBuilder`ä¸­çš„`configuration`ä¸­ã€‚å…¶ä½™çš„è§£ææ–¹æ³•åŒç†ï¼Œå°±ä¸å†èµ˜è¿°äº†ã€‚å½“æ‰€æœ‰çš„è£…é…å·¥ä½œå®Œæˆä¹‹åï¼Œ`XMLConfigBuilder.parse()`å°±ä¼šå°†è§£æåçš„`Configuration`å¯¹è±¡è¿”å›ã€‚åœ¨`SqlSessionFactoryBuilder`çš„`build()`æ–¹æ³•ä¸­ä¼šè°ƒç”¨`XMLConfigBuilder.parse()`ï¼Œæ ¹æ®ç»„è£…å¥½çš„`Configuration`å¯¹è±¡ç”Ÿæˆ`SqlSessionFactory`ï¼Œè¿›è€Œåˆ›å»º`SqlSession`ä»¥æ“ä½œæ•°æ®åº“ã€‚

```java
public SqlSessionFactory build(InputStream inputStream, String environment, Properties properties) {
      XMLConfigBuilder parser = new XMLConfigBuilder(inputStream, environment, properties);
      return build(parser.parse());
    //çœç•¥å¼‚å¸¸å¤„ç†
  }
```

å¥½äº†ï¼Œä»Šå¤©å…³äº**å»ºé€ è€…æ¨¡å¼**çš„æŠ€æœ¯åˆ†äº«å°±åˆ°æ­¤ç»“æŸã€‚éšç€æœ¬æ¬¡å»ºé€ è€…æ¨¡å¼çš„ç»“æŸï¼ŒGOF23çš„**åˆ›å»ºå‹æ¨¡å¼**å°±éƒ½è®²å®Œäº†ã€‚ä»ä¸‹ä¸€ç¯‡å¼€å§‹ï¼Œæˆ‘ä»¬ä¼šè¿›å…¥å¦å¤–ä¸€å¤§ç±»â€”â€”**ç»“æ„å‹æ¨¡å¼**çš„ä¸–ç•Œã€‚**ç»“æ„å‹æ¨¡å¼**çš„æ¨¡å¼ä¸»è¦å…³æ³¨ç‚¹æ˜¯å¦‚ä½•é€šè¿‡ä¸€å®šæ‰‹æ®µï¼Œå°†ä¸¤ä¸ªæˆ–å¤šä¸ªå¯¹è±¡ç»„åˆå½¢æˆä¸€ä¸ªæ›´å¤§æ›´å¼ºå¤§çš„å¯¹è±¡ã€‚ä¸‹ä¸€ç¯‡æˆ‘å°±å°†ä»ç»“æ„å‹æ¨¡å¼ä¸­æœ€é‡è¦ï¼Œä¹Ÿæ˜¯æœ€éš¾ç†è§£çš„ä¸€ä¸ªè®¾è®¡æ¨¡å¼â€”â€”**ä»£ç†æ¨¡å¼**å¼€å§‹è®²èµ·ï¼Œå…·ä½“æˆ‘ä»¬ä¸‹æœŸå†è¯´ï¼Œæ•¬è¯·æœŸå¾…ã€‚ğŸ˜ŠğŸ‘

